@page "/rezept/{FId:long}"

@using MamasRezepte.Client.State
@using MamasRezepte.Shared.Models
@using System.IO

@implements IDisposable

@inject DataStateDetail State
@inject HttpClient Http
@inject NavigationManager Nav

@if (State.FRecipe != null)
{
    @* Carousel *@
    <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel" style="margin-left:-12px;margin-right:-12px;">
        <div class="carousel-inner">
            @foreach (var hImageData in State.FRecipe.Images)
            {
                var hActive = State.FRecipe.Images.FirstOrDefault() == hImageData;

                <div class="carousel-item @(hActive ? "active" : "")">
                    <img src="@($"data:image/jpeg;base64,{ hImageData.ImageData }")" class="card-img-top" alt="" style="max-height:250px;  object-fit:cover;">
                </div>
            }
        </div>
        <a class="carousel-control-prev" href="#carouselExampleControls" role="button" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleControls" role="button" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </a>
    </div>


    @* Headline *@
    <div style="margin-bottom: 16px;margin-top:12px;">
        <h1 style="font-weight:bold;">@State.FRecipe.Name</h1>
    </div>

    @* Badges *@
    <div style="margin-bottom: 32px;">
        <div class="badge rounded-pill bg-secondary">@(State.FRecipe.Category.Name)</div>
        <div class="badge rounded-pill bg-secondary">@(State.FRecipe.DurationCategory.Name)</div>
        @foreach (var hTag in State.FRecipe.Tags)
        {
            <div class="badge rounded-pill bg-secondary">@(hTag.Tag.Name)</div>
        }
    </div>

    @* Ingredients *@
    <div class="row">
        <h3>Zutaten für <button type="button" class="btn btn-link" style="color:orange;"><i class="fa fa-minus"></i></button> 4 <button type="button" class="btn btn-link" style="color:orange;"><i class="fa fa-plus"></i></button> Personen</h3>
    </div>
    <div class="row justify-content-center" style="margin-bottom:32px;">
        <div class="col">
            <ul class="list-group list-group-flush">
                @foreach (var hIngredient in State.FRecipe.Ingredients)
                {
                    <li class="list-group-item row">
                        <div class="col-2"></div>
                        <div class="col-6">
                            <input class="form-check-input me-1" type="checkbox" value="" aria-label="">
                            <a>@($"{ hIngredient.Amount } { hIngredient.Unit } { hIngredient.Product.Name }")</a>
                        </div>
                    </li>
                }
            </ul>
        </div>
    </div>

    @* Instruction *@
    <h3>Zubereitung</h3>
    <p class="text-break">
        @(State.FRecipe.Instruction)
    </p>
}



@code {

    [Parameter]
    public long FId { get; set; }

    protected override void OnInitialized()
    {
        State.OnChange += StateHasChanged;
    }

    protected override async Task OnInitializedAsync()
    {
        var hRecipe = await Http.GetFromJsonAsync<Recipe>(Path.Combine(Nav.BaseUri, "api/recipes", FId + ""));

        State.SetRecipe(hRecipe);

        this.StateHasChanged();
    }

    public void Dispose()
    {
        State.OnChange -= StateHasChanged;
    }

}
